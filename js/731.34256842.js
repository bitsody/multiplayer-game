"use strict";(self["webpackChunkgeoguess"]=self["webpackChunkgeoguess"]||[]).push([[731],{6295:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r(5469);function o(e){return Array.isArray(e)?c(e):e&&e.bbox?c(e.bbox):[d(),m()]}function a(e,t){void 0===t&&(t={}),void 0!==e&&null!==e||(e=1);for(var r=[],a=0;a<e;a++)r.push(i.point(o(t.bbox)));return i.featureCollection(r)}function s(e,t){void 0===t&&(t={}),void 0!==e&&null!==e||(e=1),i.isNumber(t.num_vertices)&&void 0!==t.num_vertices||(t.num_vertices=10),i.isNumber(t.max_radial_length)&&void 0!==t.max_radial_length||(t.max_radial_length=10);for(var r=[],a=function(e){var a=[],s=Array.apply(null,new Array(t.num_vertices+1)).map(Math.random);s.forEach((function(e,t,r){r[t]=t>0?e+r[t-1]:e})),s.forEach((function(e){e=2*e*Math.PI/s[s.length-1];var r=Math.random();a.push([r*(t.max_radial_length||10)*Math.sin(e),r*(t.max_radial_length||10)*Math.cos(e)])})),a[a.length-1]=a[0],a=a.map(l(o(t.bbox))),r.push(i.polygon([a]))},s=0;s<e;s++)a(s);return i.featureCollection(r)}function n(e,t){if(void 0===t&&(t={}),t=t||{},!i.isObject(t))throw new Error("options is invalid");var r=t.bbox,a=t.num_vertices,s=t.max_length,n=t.max_rotation;void 0!==e&&null!==e||(e=1),(!i.isNumber(a)||void 0===a||a<2)&&(a=10),i.isNumber(s)&&void 0!==s||(s=1e-4),i.isNumber(n)&&void 0!==n||(n=Math.PI/8);for(var l=[],u=0;u<e;u++){for(var d=o(r),m=[d],c=0;c<a-1;c++){var h=0===c?2*Math.random()*Math.PI:Math.tan((m[c][1]-m[c-1][1])/(m[c][0]-m[c-1][0])),p=h+(Math.random()-.5)*n*2,g=Math.random()*s;m.push([m[c][0]+g*Math.cos(p),m[c][1]+g*Math.sin(p)])}l.push(i.lineString(m))}return i.featureCollection(l)}function l(e){return function(t){return[t[0]+e[0],t[1]+e[1]]}}function u(){return Math.random()-.5}function d(){return 360*u()}function m(){return 180*u()}function c(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}t.randomPosition=o,t.randomPoint=a,t.randomPolygon=s,t.randomLineString=n},5469:function(e,t){function r(e,t,r){void 0===r&&(r={});var i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function i(e,t,r){switch(void 0===r&&(r={}),e){case"Point":return o(t).geometry;case"LineString":return l(t).geometry;case"Polygon":return s(t).geometry;case"MultiPoint":return c(t).geometry;case"MultiLineString":return m(t).geometry;case"MultiPolygon":return h(t).geometry;default:throw new Error(e+" is invalid")}}function o(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!M(e[0])||!M(e[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:e};return r(o,t,i)}function a(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return o(e,t)})),r)}function s(e,t,i){void 0===i&&(i={});for(var o=0,a=e;o<a.length;o++){var s=a[o];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var n=0;n<s[s.length-1].length;n++)if(s[s.length-1][n]!==s[0][n])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return r(l,t,i)}function n(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return s(e,t)})),r)}function l(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var o={type:"LineString",coordinates:e};return r(o,t,i)}function u(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return l(e,t)})),r)}function d(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function m(e,t,i){void 0===i&&(i={});var o={type:"MultiLineString",coordinates:e};return r(o,t,i)}function c(e,t,i){void 0===i&&(i={});var o={type:"MultiPoint",coordinates:e};return r(o,t,i)}function h(e,t,i){void 0===i&&(i={});var o={type:"MultiPolygon",coordinates:e};return r(o,t,i)}function p(e,t,i){void 0===i&&(i={});var o={type:"GeometryCollection",geometries:e};return r(o,t,i)}function g(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function f(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e*i}function y(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e/i}function v(e,t){return b(y(e,t))}function w(e){var t=e%360;return t<0&&(t+=360),t}function b(e){var t=e%(2*Math.PI);return 180*t/Math.PI}function S(e){var t=e%360;return t*Math.PI/180}function P(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return f(y(e,t),r)}function k(e,r,i){if(void 0===r&&(r="meters"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[r];if(!o)throw new Error("invalid original units");var a=t.areaFactors[i];if(!a)throw new Error("invalid final units");return e/o*a}function M(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function _(e){return!!e&&e.constructor===Object}function x(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!M(e))throw new Error("bbox must only contain numbers")}))}function L(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=r,t.geometry=i,t.point=o,t.points=a,t.polygon=s,t.polygons=n,t.lineString=l,t.lineStrings=u,t.featureCollection=d,t.multiLineString=m,t.multiPoint=c,t.multiPolygon=h,t.geometryCollection=p,t.round=g,t.radiansToLength=f,t.lengthToRadians=y,t.lengthToDegrees=v,t.bearingToAzimuth=w,t.radiansToDegrees=b,t.degreesToRadians=S,t.convertLength=P,t.convertArea=k,t.isNumber=M,t.isObject=_,t.validateBBox=x,t.validateId=L},5731:function(e,t,r){r.r(t),r.d(t,{default:function(){return Be}});var i=r(641),o=r(6612),a=r(3877),s=r(3568),n=r(1742),l=r(8184),u=r(7622),d=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"game-page"}},[t("div",{attrs:{id:"street-view-container"}},[t("HeaderGame",{ref:"header",attrs:{distance:e.scoreHeader,points:e.pointsHeader,round:e.round,"room-name":e.roomName,"nb-round":e.nbRound,"remaining-time":e.remainingTime,mode:e.mode,leaderboardEnabled:e.guessedLeaderboard||e.scoreLeaderboard},on:{toggleLeaderboard:function(t){e.leaderboardShown=!e.leaderboardShown}}}),t("div",{attrs:{id:"game-interface"}},[t(s.Z,{attrs:{value:!e.isReady&&!e.multiplayer,opacity:"0.5"}},[t(n.Z,{attrs:{indeterminate:"",size:"64"}})],1),t("div",{ref:"streetView",attrs:{id:"street-view"}}),t("div",{attrs:{id:"game-interface__overlay"}},[t(u.Z,{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:i}){return[t(o.Z,e._g(e._b({staticClass:"resetBtn",attrs:{rounded:"",dark:"",fab:""},on:{click:e.resetLocation}},"v-btn",i,!1),r),[t(a.Z,[e._v("mdi-crosshairs-gps")])],1)]}}])},[t("span",[e._v(e._s(e.$t("Maps.reset")))])]),t("Maps",{ref:"mapContainer",attrs:{"random-lat-lng":e.randomLatLng,"random-feature-properties":e.randomFeatureProperties,"room-name":e.roomName,"player-number":e.playerNumber,"player-name":e.playerName,"is-ready":!!e.randomLatLng,round:e.round,score:e.score,points:e.points,difficulty:e.difficultyData,"time-limitation":e.timeLimitation,bbox:e.bbox,mode:e.mode,area:e.area,"time-attack":e.timeAttack,"nb-round":e.nbRound,countdown:e.countdown,"score-mode":e.scoreMode,areasGeoJsonUrl:e.areaParams&&e.areaParams.data.urlArea,pathKey:e.areaParams?e.areaParams.data.pathKey:"iso_a2",mapDetails:e.mapDetails},on:{resetLocation:e.resetLocation,calculateDistance:e.updateScore,showResult:e.showResult,goToNextRound:e.goToNextRound,finishGame:e.finishGame,printMapFull:function(t){e.printMapFull=t}}})],1)],1)],1),t(s.Z,{attrs:{value:e.overlay,opacity:"0.8","z-index":"1"}}),t("DialogMessage",{attrs:{"dialog-message":e.dialogMessage,"dialog-title":e.dialogTitle,"dialog-text":e.dialogText}}),t("div",{staticClass:"alert-container"},[e.$vuetify.breakpoint.mobile||!e.roomName||e.printMapFull?e._e():t("Leaderboard",{attrs:{leaderboard:e.leaderboard},model:{value:e.leaderboardShown,callback:function(t){e.leaderboardShown=t},expression:"leaderboardShown"}}),e.$vuetify.breakpoint.mobile&&e.roomName&&!e.printMapFull?t("DialogMessage",{attrs:{"dialog-title":"Leaderboard",dismissible:!0,dialogMessage:e.leaderboardShown},on:{close:function(t){e.leaderboardShown=!1}}},[t("LeaderboardContent",{attrs:{leaderboard:e.leaderboard}})],1):e._e(),e.isVisibleDialog?t(i.Z,{staticClass:"warning-alert",attrs:{type:"warning",dismissible:""}},[t("b",[e._v(e._s(e.$t("StreetView.nearby.title")))]),e._v(" : "+e._s(e.$t("StreetView.nearby.message"))+" ")]):e._e(),t(i.Z,{attrs:{id:"warningCountdown",type:"info",dismissible:"",transition:"slide-x-transition",prominent:"",icon:"mdi-clock-fast"},model:{value:e.isVisibleCountdownAlert,callback:function(t){e.isVisibleCountdownAlert=t},expression:"isVisibleCountdownAlert"}},[e._v(" "+e._s(e.$tc("StreetView.countdownAlert",e.remainingTime))+" "),t(l.Z,{attrs:{active:e.isVisibleCountdownAlert,color:"white",absolute:"",bottom:""},model:{value:e.countdownPercentage,callback:function(t){e.countdownPercentage=t},expression:"countdownPercentage"}})],1)],1)],1)},m=[],c=r(5503),h=(r(4642),r(8420)),p=function(){var e=this,t=e._self._c;return t("div",[t(h.Z,{staticClass:"header-game",attrs:{color:"grey darken-4"}},[null!=e.remainingTime&&e.remainingTime>0?t("div",[t("span",{attrs:{id:"countdown-text"}},[e._v(e._s(e.countdownText))])]):t("div",[t("span",{attrs:{id:"countdown-text"}},[e._v(e._s(e.timerText))])]),e.roomName&&!e.streamerMode?t("div",{staticClass:"round-score-container room-name"},[t("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.room"))+" : ")]),t("span",{staticClass:"main-text"},[e._v(" "+e._s(e.roomName)+" ")])]):e._e(),t("div",{staticClass:"flex-grow-1"}),t("div",{staticClass:"round-score-container"},[t("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.round"))+": ")]),t("span",{staticClass:"main-text",attrs:{id:"roundLabel"}},[e._v(" "+e._s(e.round)+" / "+e._s(e.nbRound)+" ")])]),e.isDistanceVisible?t("div",{staticClass:"round-score-container"},[t("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.distance"))+": ")]),t("span",{staticClass:"main-text"},[e._v(e._s(e.$t("HeaderGame.kmaway",{value:new Intl.NumberFormat(e.$i18n.locale).format(e.distance/1e3)})))])]):e._e(),t("div",{staticClass:"round-points-container"},[t("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.score"))+": ")]),t("span",{staticClass:"main-text"},[e._v(e._s(e.points))])]),e.roomName&&e.leaderboardEnabled?t(u.Z,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:i}){return[t(o.Z,e._g(e._b({staticClass:"ml-3",attrs:{dark:"",elevation:"",fab:"",small:""},on:{click:e.toggleLeaderboard}},"v-btn",i,!1),r),[t(a.Z,[e._v("mdi-scoreboard-outline")])],1)]}}],null,!1,3135299119)},[t("span",[e._v(e._s(e.$t("StreetView.leaderboard")))])]):e._e()],1)],1)},g=[],f=r(3442),y=r(6008),v=r(629),w={props:["distance","points","round","remainingTime","roomName","nbRound","mode","leaderboardEnabled"],data(){return{startedAt:null,timerText:"",intervalFunction:null}},watch:{round:function(){this.startTimer()}},computed:{...(0,v.rn)({streamerMode:e=>e.homeStore.streamerMode}),countdownText(){return(0,f.Xw)(this.remainingTime)},isDistanceVisible(){return this.mode!==y.wz.COUNTRY}},methods:{startTimer(){0==this.remainingTime&&(this.startedAt=new Date,this.intervalFunction=setInterval((()=>{this.timerText=(0,f.Xw)(Math.round((Date.now()-this.startedAt)/1e3))}),1e3))},stopTimer(){this.intervalFunction&&clearInterval(this.intervalFunction)},toggleLeaderboard(){this.$emit("toggleLeaderboard")}}},b=w,S=r(1001),P=(0,S.Z)(b,p,g,!1,null,"3611ba70",null),k=P.exports,M=function(){var e=this,t=e._self._c;return t("div",e._g({class:[e.$viewport.width>=450&&(e.activeMap||e.pinActive)||e.isMakeGuessButtonClicked||e.isNextButtonVisible?"container-map--active":"",e.printMapFull?"container-map--full":"",`container-map--size-${e.size}`],attrs:{id:"container-map"}},e.$viewport.width>=450?{mouseover:()=>{e.activeMap=!0},mouseleave:()=>{e.activeMap=!1}}:{}),[t("div",{staticClass:"container-map_details"},[t("div",{staticClass:"alert-container"},[e.guessString&&!e.$vuetify.breakpoint.mobile&&e.leaderboardShown?t("Leaderboard",{attrs:{"leaderboard-shown":e.leaderboardShown}}):e._e()],1),e.printMapFull?t("DetailsMap",{attrs:{properties:e.randomFeatureProperties}}):e._e()],1),t("div",{staticClass:"container-map_controls"},[t("div",{staticClass:"container-map_btns"},[t(o.Z,{attrs:{fab:"","x-small":""},on:{click:e.showNotepad}},[t(a.Z,{attrs:{dark:""}},[e._v(" mdi-file-document-edit ")])],1),t(o.Z,{attrs:{id:"btnDown",fab:"","x-small":"",disabled:e.size<2},on:{click:function(t){e.size--}}},[t(a.Z,{attrs:{dark:""}},[e._v(" mdi-arrow-bottom-left ")])],1),t(o.Z,{attrs:{id:"btnUp",fab:"","x-small":"",disabled:e.size>3},on:{click:function(t){e.size++}}},[t(a.Z,{attrs:{dark:""}},[e._v(" mdi-arrow-top-right ")])],1),t(o.Z,{attrs:{id:"btnPin",fab:"","x-small":""},on:{click:function(t){e.pinActive=!e.pinActive}}},[t(a.Z,{attrs:{dark:""}},[e._v(" mdi-pin"+e._s(e.pinActive?"-off":"")+" ")])],1)],1)]),e.$viewport.width<450&&!e.isGuessButtonClicked&&e.isMakeGuessButtonClicked?t(o.Z,{attrs:{id:"hide-map-button",fab:"","x-small":"",color:"red"},on:{click:e.hideMap}},[t(a.Z,{attrs:{color:"white"}},[e._v(" mdi-close ")])],1):e._e(),"classic"===this.mode?t("Map",{ref:"map",attrs:{id:"map",bbox:e.bbox},on:{setSeletedPos:e.setSeletedPos}}):e._e(),"classic"!==this.mode?t("MapAreas",{ref:"map",attrs:{id:"map",area:e.area,areasGeoJsonUrl:e.areasGeoJsonUrl,pathKey:e.pathKey,bbox:e.bbox,showFlag:"country"===this.mode},on:{setSeletedPos:e.setSeletedPos}}):e._e(),e.printMapFull?e._e():t("textarea",{directives:[{name:"show",rawName:"v-show",value:e.isNotepadVisible,expression:"isNotepadVisible"}],ref:"refNotepad",staticClass:"container-map_notepad",attrs:{spellcheck:"false"}}),e._v(" "),e.isNextButtonVisible||e.isSummaryButtonVisible||!(e.$viewport.width>450||e.isMakeGuessButtonClicked)?e._e():t("button",{attrs:{id:"guess-button",disabled:null==e.randomLatLng||null==e.selectedPos||e.isGuessButtonClicked||!!this.room&&!e.isReady},on:{click:e.selectLocation}},[e._v(" "+e._s(e.$t("Maps.guess"))+" ")]),e.isNextButtonVisible?t("button",{style:{backgroundColor:e.isNextButtonEnabled?"#F44336":"#B71C1C"},attrs:{id:"next-button",disabled:!e.isNextButtonEnabled},on:{click:function(t){return e.goToNextRound(!1)}}},[e._v(" "+e._s(e.$t("Maps.nextRound"))+" ")]):e._e(),e.isSummaryButtonVisible?t("button",{attrs:{id:"summary-button"},on:{click:function(t){e.dialogSummary=!0}}},[e._v(" "+e._s(e.$t("Maps.viewSummary"))+" ")]):e._e(),e.$viewport.width<450&&!e.isGuessButtonClicked&&!e.isMakeGuessButtonClicked&&!e.isNextButtonVisible?t("button",{staticClass:"primary",attrs:{id:"make-guess-button"},on:{click:e.showMap}},[e._v(" "+e._s(e.$t("Maps.makeGuess"))+" ")]):e._e(),t("DialogSummary",{attrs:{"dialog-summary":e.dialogSummary,"summary-texts":e.summaryTexts,score:e.score,"player-name":e.playerName,points:e.points,game:e.game,multiplayer:!!e.room,mapDetails:e.mapDetails,"nb-round":e.nbRound},on:{finishGame:e.finishGame,playAgain:function(t){return e.goToNextRound(!0)}}})],1)},_=[],x=r(3841),L=r(5474),C=r(441),N=r(33),R=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{value:e.dialogSummary,"max-width":"720",persistent:"",fullscreen:e.$viewport.width<450}},[t(x.Z,{attrs:{color:"#061422"}},[t(L.ZB,{attrs:{id:"card-text"}},[e.multiplayer?e._e():t(N.Z,{attrs:{justify:"center"}},[t("p",{attrs:{id:"summary-text"},domProps:{innerHTML:e._s(e.$t("DialogSummary.summaryMsgSinglePoints",{points:e.points})+(e.showDistance?e.$t("DialogSummary.summaryMsgSingleDistance",{distance:e.score/1e3}):""))}})]),e._l(e.summaryTexts,(function(r,i){return t(N.Z,{key:i,staticClass:"mt-3",attrs:{justify:"center"}},[t("span",{attrs:{id:"summary-text"}},[0==i||1==i||2==i?t(a.Z,{attrs:{color:0==i?"#CCAC00":1==i?"#C0C0C0":"#CC8E34"}},[e._v("mdi-crown")]):e._e(),t("span",{domProps:{innerHTML:e._s(e.$t("DialogSummary.summaryMsgMultiPoints",{playerName:r.playerName,points:r.finalPoints})+(e.showDistance?e.$t("DialogSummary.summaryMsgMultiDistance",{distance:r.finalScore/1e3}):""))}})],1)])})),t(N.Z,{staticClass:"mt-8",attrs:{justify:"center"}},[t(o.Z,{staticClass:"mt-8",attrs:{id:"play-again-button",dark:"",color:"#43B581"},on:{click:function(t){return e.$emit("finishGame")}}},[e._v(" "+e._s(e.$t("DialogSummary.viewDetails"))+" ")]),e.multiplayer?e._e():t(o.Z,{staticClass:"mt-8",attrs:{id:"exit-button",dark:"",color:"#f44336"},on:{click:function(t){return e.$emit("playAgain")}}},[e._v(" "+e._s(e.$t("Maps.playAgain"))+" ")])],1)],2)],1)],1)},E=[],T={props:["dialogSummary","summaryTexts","playerName","score","points","multiplayer","game","mode","mapDetails","nbRound"],computed:{showDistance(){return this.mode===y.wz.CLASSIC}},watch:{dialogSummary:function(e){1==e&&this.updateRecord()}},methods:{updateRecord(){let e=localStorage.getItem("history");e=null==e?[]:JSON.parse(e),e.push({...this.game,score:this.score,points:this.points,rank:this.multiplayer?this.summaryTexts.findIndex((e=>e.playerName===this.playerName))+1:void 0,nbRound:this.nbRound,mapDetails:this.mapDetails}),localStorage.setItem("history",JSON.stringify(e))},finishGame(){this.$emit("finishGame")}}},A=T,$=(0,S.Z)(A,R,E,!1,null,"200a3bd4",null),V=$.exports,F=function(){var e=this,t=e._self._c;return e.properties&&"object"===typeof e.properties&&(e.properties.title||e.properties.description)?t("div",{staticClass:"details-map_container"},[t("h2",[e._v(" "+e._s(e.properties.title)+" ")]),t("p",[e._v(" "+e._s(e.properties.description)+" ")]),e.properties.link&&e.validURL(e.properties.link)?t("a",{staticClass:"details-map_link",attrs:{href:e.properties.link,target:"_blank"}},[t(a.Z,{attrs:{color:"darkGreen"}},[e._v("mdi-alert-circle")]),e._v(" "+e._s(e.$t("DetailsMap.moreInfo")))],1):e._e()]):e._e()},G=[],O={name:"DetailsMap",props:["properties"],methods:{validURL(e){return(0,f.b3)(e)}}},D=O,B=(0,S.Z)(D,F,G,!1,null,"4d0af0f4",null),Z=B.exports,I=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"map"}},[t("GmapMap",{ref:"mapRef",attrs:{id:"mapClassic",center:{lat:37.86926,lng:-122.254811},zoom:1,"map-type-id":"roadmap",options:{fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,draggableCursor:"crosshair",clickableIcons:!1,styles:e.$vuetify.theme.dark?e.$vuetify.theme.themes.dark.gmap:e.$vuetify.theme.themes.light.gmap}}})],1)},z=[];const U={props:["bbox"],watch:{bbox(){this.centerOnBbox()}},methods:{centerOnBbox(){this.map&&(this.bbox?this.map.fitBounds({east:this.bbox[2],north:this.bbox[3],south:Math.max(this.bbox[1],-89),west:this.bbox[0]}):(this.map.setZoom(0),this.map.setCenter({lat:0,lng:0})))},drawPolyline(){},removePolylines(){}}};var j=U,q={name:"Map",mixins:[j],data(){return{map:null,marker:[],markers:[],polylines:[],strokeColors:y.G8}},async mounted(){await this.$gmapApiPromiseLazy(),this.$refs.mapRef.$mapPromise.then((e=>{this.map=e,this.centerOnBbox()}))},methods:{putMarker(e,t,r){let i={};t&&(i={icon:{url:window.location.origin+"/img/icons/favicon-16x16.png",anchor:new google.maps.Point(8,8)}}),r&&(i={label:r});const o=new google.maps.Marker({...i,position:e,map:this.map});this.markers.push(o)},removeMarkers(){for(const e of this.markers)e.setMap(null);this.markers=[]},setInfoWindow(e,t,r,i=!1){let o="";o+=t<1e3?"<b>"+this.$t("Maps.infoWindow.Distance")+": </b>"+new Intl.NumberFormat(this.$i18n.locale,{style:"unit",unit:"meter"}).format(t):"<b>"+this.$t("Maps.infoWindow.Distance")+": </b>"+new Intl.NumberFormat(this.$i18n.locale,{style:"unit",unit:"kilometer"}).format(t/1e3),o+="<br/><b>"+this.$t("Maps.infoWindow.Points")+": </b>"+r;const a=new google.maps.InfoWindow({headerContent:e,headerDisabled:!e,content:`<div>${o}</div>`});a.open(this.map,this.markers[e||i?this.markers.length-1:0])},drawPolyline(e,t=0,r){const i={path:"M 0,-1 0,1",strokeOpacity:1,scale:2},o=new google.maps.Polyline({path:[e,r],strokeOpacity:0,strokeColor:this.strokeColors[t%this.strokeColors.length],icons:[{icon:i,offset:"0",repeat:"10px"}]});o.setMap(this.map),this.polylines.push(o)},removePolylines(){for(const e of this.polylines)e.setMap(null)},startNextRound(){this.$refs.mapRef.$mapPromise.then((()=>{this.map.addListener("click",(e=>{this.removeMarkers(),this.putMarker(e.latLng),this.$emit("setSeletedPos",e.latLng)})),this.centerOnBbox()}))},removeListener(){google.maps.event.clearListeners(this.map,"click")},fitBounds(){const e=new google.maps.LatLngBounds;for(const t of this.markers)t.getVisible()&&e.extend(t.getPosition());this.map.fitBounds(e)}}},J=q,H=(0,S.Z)(J,I,z,!1,null,"3c21c1d4",null),K=H.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"map-areas",attrs:{id:"map"}},[t("div",{staticClass:"map-content"},[e.polygonSelect||e.areaName?t("div",{staticClass:"map-label",attrs:{title:e.areaName}},[e.showFlag?t("FlagIcon",{attrs:{size:"big",rounded:"","iso-name":e.areaRandom||e.areaNameSelect}}):e._e(),t("span",{staticClass:"map-label__country-name",class:{beige:!e.areaRandom,green:!!e.areaRandom,"white--text":!!e.areaRandom,large:!e.showFlag}},[e._v(" "+e._s(e.areaName)+" ")])],1):e._e(),t("GmapMap",{ref:"mapRef",attrs:{id:"mapAreas",center:{lat:37.86926,lng:-122.254811},zoom:1,"map-type-id":"roadmap",options:{fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,draggableCursor:"crosshair",clickableIcons:!1,styles:e.$vuetify.theme.dark?e.$vuetify.theme.themes.dark.gmap:e.$vuetify.theme.themes.light.gmap}}})],1),e.infoWindowDatas.length>0?t("div",{staticClass:"result-panel"},e._l(e.infoWindowDatas,(function(r){return t("div",{key:r.playerName,staticClass:"result-panel__item",class:{flag:e.showFlag}},[e.showFlag?t("FlagIcon",{attrs:{"iso-name":r.area}}):e._e(),t("b",[e._v(e._s(r.playerName))]),e.showFlag?e._e():t("span",[e._v(e._s(r.area))])],1)})),0):e._e()])},Y=[],X=r(6813),Q={mixins:[j],components:{FlagIcon:X.Z},props:{area:{type:String},areasGeoJsonUrl:String,pathKey:{type:String,default:"iso_a2"},showFlag:Boolean},data(){return{map:null,polygonSelect:null,areas:{},markers:[],allowSelect:!0,areaRandom:null,randomPos:null,infoWindowDatas:[]}},computed:{...(0,v.Se)(["areasJson"]),areaName(){return this.showFlag&&(this.areaRandom||this.polygonSelect)?this.$countryNameLocale(this.areaRandom||this.areaNameSelect):this.areaRandom||this.areaNameSelect},areaNameSelect(){return this.polygonSelect?this.polygonSelect.getFeatureById("feature").getProperty(this.pathKey):void 0}},async mounted(){await this.loadAreas(this.areasGeoJsonUrl),await this.$gmapApiPromiseLazy(),this.$refs.mapRef.$mapPromise.then((e=>{this.map=e,this.areasJson.features.forEach((e=>{if(Array.isArray(e.geometry.coordinates)){const t=new google.maps.Data({style:{strokeOpacity:0,fillOpacity:0,strokeWeight:2}});e.id="feature",t.addGeoJson(e),t.setMap(this.map),t.addListener("click",(()=>{this.allowSelect&&(this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),Object.is(t,this.polygonSelect)?(this.polygonSelect=null,this.$emit("setSeletedPos",null)):(t.setStyle({strokeOpacity:.8,fillOpacity:.3,strokeColor:"#1E3A8A",fillColor:"#1D4ED8"}),this.polygonSelect=t,this.$emit("setSeletedPos",t.getFeatureById("feature").getProperty(this.pathKey))))})),this.areas[e.properties[this.pathKey]]=t}})),this.centerOnBbox()}))},methods:{...(0,v.nv)(["loadAreas"]),putMarker(e,t,r){const i=t?r||this.area:e;t&&(this.areaRandom=this.area,this.randomPos=new google.maps.Marker({position:e,map:this.map})),this.areas[i]&&(this.areas[i].setStyle({fillOpacity:.3,strokeOpacity:.8,fillColor:t?"#52DA42":"#FF4081",strokeColor:t?"#16A910":"#FF4081"}),this.markers.push(i))},removeMarkers(){this.markers.forEach((e=>{this.areas[e].setStyle({strokeOpacity:0,fillOpacity:0})})),this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),this.randomPos&&(this.randomPos.setMap(null),this.randomPos=null),this.markers=[],this.infoWindowDatas=[]},setInfoWindow(e,t,r,i,o){e&&this.infoWindowDatas.push({playerName:e,area:o})},startNextRound(){this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),this.polygonSelect=null,this.areaRandom=null,this.allowSelect=!0,this.centerOnBbox()},removeListener(){this.allowSelect=!1},fitBounds(){this.bbox?this.centerOnBbox():this.map.setZoom(2)}}},ee=Q,te=(0,S.Z)(ee,W,Y,!1,null,"30884500",null),re=te.exports;function ie(e,t,r,i){switch(i){case y.se.TIME:return Math.round(oe(e,t)*Math.exp(-r/6e6));default:return oe(e,t)}}function oe(e,t){if(e<50)return 5e3;{const r=Math.round(5e3*Math.exp(-e/1e3/t));return r>5e3?5e3:r<0?0:r}}var ae=function(){var e=this,t=e._self._c;return t(i.Z,{staticClass:"mt-2 mr-2",attrs:{id:"leaderboard-alert",transition:"slide-x-reverse-transition",width:"300",dark:"",dismissible:"",value:e.value},on:{input:t=>e.$emit("input",t)}},[t("h4",[e._v("Leaderboard")]),t("LeaderboardContent",{attrs:{leaderboard:e.leaderboard}})],1)},se=[],ne=function(){var e=this,t=e._self._c;return t("div",e._l(e.leaderboard,(function({name:r,scoreHeader:i,guessed:o,id:s}){return t("div",{key:s,staticClass:"leaderboard-alert__line"},[t("div",[o?t(a.Z,{attrs:{color:"green"}},[e._v("mdi-check")]):e._e()],1),t("p",[e._v(" "+e._s(r)+" "+e._s(i?`: ${i}`:"")+" ")])])})),0)},le=[],ue={name:"Leaderboard",props:{leaderboard:Array}},de=ue,me=(0,S.Z)(de,ne,le,!1,null,"7a33b83f",null),ce=me.exports,he={name:"Leaderboard",props:{leaderboard:Array,value:Boolean},components:{LeaderboardContent:ce}},pe=he,ge=(0,S.Z)(pe,ae,se,!1,null,"41b5218a",null),fe=ge.exports,ye={components:{Leaderboard:fe,DialogSummary:V,DetailsMap:Z,Map:K,MapAreas:re},props:["randomLatLng","randomFeatureProperties","roomName","playerNumber","playerName","isReady","round","score","points","timeLimitation","difficulty","bbox","mode","area","timeAttack","nbRound","countdown","scoreMode","areasGeoJsonUrl","pathKey","mapDetails","leaderboardShown","guessString"],data(){return{summaryTexts:[],room:null,selectedPos:null,distance:null,point:null,isGuessButtonClicked:!1,isMakeGuessButtonClicked:!1,isSelected:!1,isNextStreetViewReady:!1,isNextButtonVisible:!1,isSummaryButtonVisible:!1,dialogSummary:!1,activeMap:!1,size:2,isNotepadVisible:!1,pinActive:"true"===localStorage.getItem("pinActive"),printMapFull:!1,countdownStarted:!1,game:{multiplayer:!!this.roomName,date:new Date,rounds:[]},startTime:null}},computed:{isNextButtonEnabled(){return 1==this.playerNumber||!this.room||this.isNextStreetViewReady}},watch:{pinActive(){localStorage.setItem("pinActive",this.pinActive)},printMapFull(e){this.$emit("printMapFull",e)}},async mounted(){await this.$gmapApiPromiseLazy(),this.game.timeLimitation=this.timeLimitation,this.game.difficulty=this.difficulty,this.game.mode=this.mode,this.game.timeAttack=this.timeAttack,this.game.playerName=this.playerName;let e=0;this.roomName&&(this.room=c.Z.database().ref(this.roomName),this.room.on("value",(t=>{if(t.hasChild("active")){if(e=t.child("size").val(),1===e?this.room.onDisconnect().remove():this.room.onDisconnect().update({size:e-1}),this.timeAttack&&0===this.countdown&&t.child("guess").numChildren()>=1&&t.child("guess").forEach((e=>e.child("area").val()===this.area))||t.child("guess").numChildren()===e){this.game.timeLimitation=this.timeLimitation,this.isNextStreetViewReady=!1,this.$emit("showResult");let e=0,r={};t.child("guess").forEach((i=>{let o;if(this.mode===y.wz.CLASSIC){const e=i.child("latitude").val(),t=i.child("longitude").val();o=new google.maps.LatLng({lat:e,lng:t})}else o=i.child("area").val();const a=t.child("playerName").child(i.key).val(),s=t.child("round"+this.round+"/"+i.key).exportVal(),{points:n,distance:l}=s;r[a]={...s,guess:o},this.$refs.map.drawPolyline(o,e,this.randomLatLng),this.$refs.map.putMarker(o,!1,a&&a.length>0?a[0].toUpperCase():""),this.$refs.map.setInfoWindow(a,l,n,!1,o),e++})),this.$refs.map.fitBounds(),this.game.rounds.push({position:{...this.randomLatLng.toJSON(),area:this.area},players:r}),this.$refs.map.putMarker(this.randomLatLng,!0),this.printMapFull=!0,this.room.child("guess").remove(),this.round>=this.nbRound?(t.child("finalPoints").forEach((e=>{const r=t.child("playerName").child(e.key).val(),i=t.child("finalScore").child(e.key).val(),o=e.val();this.summaryTexts.push({playerName:r,finalScore:i,finalPoints:o})})),this.summaryTexts.sort(((e,t)=>parseInt(t.finalPoints)-parseInt(e.finalPoints))),this.isSummaryButtonVisible=!0):this.isNextButtonVisible=!0}t.child("streetView").numChildren()==this.round+1&&(this.isNextStreetViewReady=!0),!this.countdownStarted&&!this.printMapFull&&this.countdown>0&&t.child("guess").numChildren()>=1&&(this.$parent.initTimer(this.countdown,!0),this.countdownStarted=!0)}})))},methods:{setSeletedPos(e){this.selectedPos=e},showMap(){this.isMakeGuessButtonClicked=!0},hideMap(){this.isMakeGuessButtonClicked=!1},showNotepad(){this.isNotepadVisible=!this.isNotepadVisible,this.isNotepadVisible&&setTimeout((()=>{this.$refs.refNotepad.focus()}))},selectLocation(){this.calculateDistance(),this.room?this.room.child("guess/player"+this.playerNumber).set((0,f.nV)(this.selectedPos,this.mode)):(this.$refs.map.putMarker(this.randomLatLng,!0),this.$refs.map.drawPolyline(this.selectedPos,1,this.randomLatLng),this.$refs.map.setInfoWindow(null,this.distance,this.point,!1,this.setSeletedPos),this.printMapFull=!0,this.$refs.map.fitBounds(),this.round>=this.nbRound?this.isSummaryButtonVisible=!0:this.isNextButtonVisible=!0,this.$emit("showResult")),this.$refs.map.removeListener(),this.isGuessButtonClicked=!0,this.isSelected=!0,this.isNextStreetViewReady=!1},selectRandomLocation(e){null===this.selectedPos&&(this.selectedPos=e,this.$refs.map.removeMarkers(),this.$refs.map.putMarker(this.selectedPos)),this.selectLocation()},resetLocation(){this.$emit("resetLocation")},calculateDistance(){const e=new Date-this.startTime;[y.wz.COUNTRY,y.wz.CUSTOM_AREA].includes(this.mode)?(this.point=+(this.area===this.selectedPos),this.distance=null):(this.distance=Math.floor(google.maps.geometry.spherical.computeDistanceBetween(this.randomLatLng,this.selectedPos)),this.point=ie(this.distance,this.difficulty,e,this.scoreMode)),this.room?this.room.child("round"+this.round+"/player"+this.playerNumber).set({...(0,f.nV)(this.selectedPos,this.mode),distance:this.distance,points:this.point,timePassed:e}):this.game.rounds.push({guess:this.selectedPos,area:this.area,position:this.randomLatLng,distance:this.distance,points:this.point,timePassed:e}),this.$emit("calculateDistance",this.distance,this.point)},startNextRound(){this.$refs.map.startNextRound(),this.startTime=new Date},goToNextRound(e=!1){e&&(this.dialogSummary=!1,this.isSummaryButtonVisible=!1),this.selectedPos=null,this.isGuessButtonClicked=!1,this.isSelected=!1,this.isNextButtonVisible=!1,this.countdownStarted=!1,this.isNotepadVisible=!1,this.$viewport.width<450&&this.hideMap(),this.printMapFull=!1,this.$refs.map.removeMarkers(),this.$refs.map.removePolylines(),this.$refs.map.centerOnBbox(),this.$emit("goToNextRound",e)},finishGame(){this.dialogSummary=!1,this.room&&this.room.child("isGameDone/player"+this.playerNumber).set(!0),this.$emit("finishGame")}}},ve=ye,we=(0,S.Z)(ve,M,_,!1,null,"f0261f86",null),be=we.exports,Se=r(2003),Pe=r(8233),ke=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{value:e.dialogMessage,"max-width":"600",persistent:"",fullscreen:e.$viewport.width<450}},[t(x.Z,{attrs:{color:"#061422"}},[t(L.EB,[t("span",{staticClass:"dialog-message__title",attrs:{id:"card-title"}},[e._v(e._s(e.dialogTitle))]),t(Pe.Z),e.dismissible?t(o.Z,{attrs:{icon:""},on:{click:function(t){return e.$emit("close")}}},[t(a.Z,[e._v("mdi-close")])],1):e._e()],1),t(L.ZB,[t(Se.Z,[e._t("default",(function(){return[t("span",[e._v(e._s(e.dialogText))])]}))],2)],1)],1)],1)},Me=[],_e={props:["dialogMessage","dialogTitle","dialogText","dismissible"]},xe=_e,Le=(0,S.Z)(xe,ke,Me,!1,null,"41bf8db0",null),Ce=Le.exports,Ne=r(825),Re=r(8906),Ee=r(883),Te=r(3043),Ae=r.n(Te);class $e{constructor(e,t,r,i){this.settingsPanorama=e,this.settingsGame=t,this.placeGeoJson=r,this.roundsPredefined=i,this.service=new google.maps.StreetViewService,this.alreadyVisited=[]}async getStreetView(e,t=0){let r,i,o;if(this.roundsPredefined){r=50;const t=this.roundsPredefined[e-1];i=new google.maps.LatLng(t[0],t[1])}else{let e;do{e=this.getRandomLatLng()}while(this.alreadyVisited.includes(e.position.toString()));this.alreadyVisited.push(e.position.toString()),r=e.radius,i=e.position,o=e.properties}return new Promise((a=>{this.service.getPanorama({location:i,preference:"nearest",radius:r,sources:this.settingsPanorama.allPanorama?[google.maps.StreetViewSource.DEFAULT,google.maps.StreetViewSource.OUTDOOR,google.maps.StreetViewSource.GOOGLE]:[google.maps.StreetViewSource.GOOGLE]},(async(r,i)=>{i===google.maps.StreetViewStatus.OK&&r&&r.location&&this._checkStreetView(r)?a(await this._getResponseStreetViewService(e,r,t,o)):a(await this.getStreetView(e))}))}))}async _getResponseStreetViewService(e,t,r,i){let o,a=!1;if(null!=this.placeGeoJson&&(o=(0,f.Rw)(Ee.xm([t.location.latLng.lng(),t.location.latLng.lat()]),this.placeGeoJson)),!1===o&&r<3)return this.getStreetView(e,r+1);{let r;!1===o&&(a=!0);try{r=await this._getAreaCode(t)}catch(s){return this.getStreetView(e)}return{panorama:t,roundInfo:i||null,area:r,warning:a}}}getRandomLatLng(){if(null!=this.placeGeoJson){let e,t,r=null;if("FeatureCollection"===this.placeGeoJson.type){let i=Math.floor(Math.random()*this.placeGeoJson.features.length);const o=this.placeGeoJson.features[i];r=o.properties,"Point"===o.geometry.type?(e=o.geometry.coordinates,t=50):(t=10*(0,f.CX)((0,Ne.Z)(o)),e=Ae()(o))}else t=10*(0,f.CX)((0,Ne.Z)(this.placeGeoJson)),e=Ae()(this.placeGeoJson);return{radius:t,position:new google.maps.LatLng(e[1],e[0]),properties:r}}const e=57.2958*Math.acos(1.99*Math.random()-.995)-90,t=360*Math.random()-180;return{radius:1e5,position:new google.maps.LatLng(e,t),properties:null}}_checkStreetView(e){return!(this.settingsPanorama.optimiseStreetView&&(!e.imageDate||e.links.length<2||Array.isArray(e.g)&&0!==e.g.length))}async _getAreaCode(e){if([y.wz.COUNTRY,y.wz.CUSTOM_AREA].includes(this.settingsGame.mode)){if(this.settingsGame.mode===y.wz.COUNTRY||this.settingsGame.areaParams&&this.settingsGame.areaParams.data.type===y.Ho.NOMINATIM)return(0,f.Xp)(e.location.latLng,this.settingsGame.areaParams&&this.settingsGame.areaParams.data);{const t=this.settingsGame.areasJson.features.find((t=>(0,Re.Z)([e.location.latLng.lng(),e.location.latLng.lat()],t)));if(t){const e=this.settingsGame.areaParams?this.settingsGame.areaParams.data.pathKey:"iso_a2";return t.properties[e]}throw new Error("Area not found")}}}}var Ve=$e,Fe={data(){return{canExit:!1}},methods:{beforeUnload(e){e.returnValue=this.$t("StreetView.confirmExit")}},created(){window.addEventListener("beforeunload",this.beforeUnload)},beforeRouteLeave(e,t,r){if(this.canExit)r();else{const e=window.confirm(this.$t("StreetView.confirmExit"));e?r():r(!1)}},beforeDestroy(){window.removeEventListener("beforeunload",this.beforeUnload)}},Ge={components:{Leaderboard:fe,HeaderGame:k,Maps:be,DialogMessage:Ce,LeaderboardContent:ce},mixins:[Fe],props:{roomName:{default:null,type:String},allPanorama:{default:!1,type:Boolean},optimiseStreetView:{default:!0,type:Boolean},playerNumber:{default:null,type:Number},playerName:{default:null,type:String},placeGeoJson:{default:null,type:Object},multiplayer:{default:!1,type:Boolean},time:{default:0,type:Number},difficulty:{default:2e3,type:Number},bboxObj:{default:null,type:Array},roundsPredefined:{default:null,type:Array},modeSelected:{default:y.wz.CLASSIC,type:String},panControl:{default:!0,type:Boolean},zoomControl:{default:!0,type:Boolean},moveControl:{default:!0,type:Boolean},timeAttackSelected:{default:!1,type:Boolean},countdown:{default:0,type:Number},scoreMode:{default:y.se.NORMAL,type:String},areaParams:{type:Object},mapDetails:{type:Object,required:!1,default:void 0},nbRoundSelected:{type:Number,required:!1,default:5},guessedLeaderboard:{default:!0,type:Boolean},scoreLeaderboard:{default:!0,type:Boolean}},data(){return{area:null,randomLatLng:null,randomFeatureProperties:null,score:0,scoreHeader:0,points:0,pointsHeader:0,round:1,timeLimitation:this.time,mode:this.modeSelected,timeAttack:this.timeAttackSelected,nbRound:this.timeAttackSelected?10:this.nbRoundSelected,remainingTime:0,endTime:null,hasTimerStarted:!1,hasLocationSelected:!1,overlay:!1,room:null,isReady:!1,dialogMessage:this.multiplayer,dialogTitle:this.$t("StreetView.waitForOtherPlayers"),dialogText:"",isVisibleDialog:!1,panorama:null,difficultyData:this.difficulty,bbox:this.bboxObj,isVisibleCountdownAlert:!1,timeCountdown:0,streetViewService:null,leaderboard:[],leaderboardShown:!this.$vuetify.breakpoint.mobile&&this.roomName&&(this.guessedLeaderboard||this.scoreLeaderboard),printMapFull:!1}},computed:{...(0,v.Se)(["areasJson"]),...(0,v.rn)("settingsStore",["players"]),countdownPercentage(){return 100*this.remainingTime/this.timeCountdown}},async mounted(){(this.areaParams&&this.areaParams.data.urlArea||this.mode===y.wz.COUNTRY)&&await this.loadAreas(this.areaParams&&this.areaParams.data.urlArea),await this.$gmapApiPromiseLazy(),this.panorama=new google.maps.StreetViewPanorama(this.$refs.streetView),this.streetViewService||(this.streetViewService=new Ve({allPanorama:this.allPanorama,optimiseStreetView:this.optimiseStreetView},{mode:this.mode,areaParams:this.areaParams,areasJson:this.areasJson},this.placeGeoJson,this.roundsPredefined)),this.multiplayer?(this.roomName||this.exitGame(),this.room=c.Z.database().ref(this.roomName),1===this.playerNumber&&await this.loadStreetView(),this.room.child("active").set(!0),this.room.on("value",(e=>{if(e.hasChild("active")){if(this.scoreLeaderboard?this.leaderboard=Object.entries(e.val().playerName).map((t=>({scoreHeader:this.leaderboard.find((e=>e.id===t[0]))?.scoreHeader||0,score:e.val()?.finalPoints?.[t[0]]||0,name:t[1],id:t[0],guessed:!!e.val()?.guess?.[t[0]]}))):this.guessedLeaderboard&&(this.leaderboard=Object.entries(e.val().playerName).map((t=>({name:t[1],guessed:!!e.val()?.guess?.[t[0]],id:t[0]})))),!e.child("round"+this.round).hasChild("player"+this.playerNumber)&&(this.room.child("round"+this.round).child("player"+this.playerNumber).set(0),1!=this.playerNumber)){let t=e.child("streetView/round"+this.round+"/latitude").val(),r=e.child("streetView/round"+this.round+"/longitude").val();this.area=e.child("streetView/round"+this.round+"/area").val(),this.isVisibleDialog=e.child("streetView/round"+this.round+"/warning").val(),this.randomFeatureProperties=e.child("streetView/round"+this.round+"/roundInfo").val(),this.randomLatLng=new google.maps.LatLng(t,r),this.resetLocation()}e.child("round"+this.round).numChildren()!==e.child("size").val()||this.isReady||(this.dialogMessage=!1,this.dialogText="",this.isReady=!0,this.$refs.mapContainer.startNextRound(),this.timeLimitation=e.child("timeLimitation").val(),0!=this.timeLimitation&&(this.hasTimerStarted||(this.initTimer(this.timeLimitation),this.hasTimerStarted=!0))),e.child("isGameDone").numChildren()==e.child("size").val()&&(this.room.child("active").remove(),this.room.off(),this.room.remove())}else this.exitGame()}))):(await this.loadStreetView(),this.$refs.mapContainer.startNextRound(),0!=this.timeLimitation&&(this.hasTimerStarted||(this.initTimer(this.timeLimitation),this.hasTimerStarted=!0)),this.isReady=!0),this.$refs.header.startTimer()},beforeDestroy(){document.querySelector(".widget-scene")&&(document.querySelector(".widget-scene").removeEventListener("keydown",this.onUserEventPanoramaKey),document.querySelector(".widget-scene").removeEventListener("mousedown",this.onUserEventPanoramaMouse)),window.removeEventListener("beforeunload",this.beforeUnload),this.room&&(this.room.child("active").remove(),this.room.off())},methods:{...(0,v.nv)(["loadAreas"]),async loadStreetView(){let{panorama:e,roundInfo:t,warning:r,area:i}=await this.streetViewService.getStreetView(this.round);this.randomLatLng=e.location.latLng,this.randomFeatureProperties=t,this.area=i,this.setPosition(e),this.multiplayer&&this.room.child("streetView/round"+this.round).set({latitude:this.randomLatLng.lat(),longitude:this.randomLatLng.lng(),roundInfo:t,...i&&{area:i},warning:r})},resetLocation(){const e=new google.maps.StreetViewService;e.getPanorama({location:this.randomLatLng,preference:"nearest",radius:50,sources:this.allPanorama?[google.maps.StreetViewSource.DEFAULT,google.maps.StreetViewSource.OUTDOOR,google.maps.StreetViewSource.GOOGLE]:[google.maps.StreetViewSource.GOOGLE]},this.setPosition)},setPosition(e){this.panorama.setOptions({addressControl:!1,fullscreenControl:!1,motionTracking:!1,motionTrackingControl:!1,showRoadLabels:!1,panControl:this.panControl,zoomControl:this.zoomControl,scrollwheel:this.zoomControl,disableDoubleClickZoom:!this.zoomControl,linksControl:this.moveControl,clickToGo:this.moveControl}),document.querySelector('#street-view a[href^="https://maps"]')&&document.querySelector('#street-view a[href^="https://maps"]').remove(),setTimeout((()=>{document.querySelector(".widget-scene")&&(document.querySelector(".widget-scene").addEventListener("keydown",this.onUserEventPanoramaKey),document.querySelector(".widget-scene").addEventListener("mousedown",this.onUserEventPanoramaMouse),document.querySelector(".widget-scene").addEventListener("touchstart",this.onUserEventPanoramaMouse),document.querySelector(".widget-scene").addEventListener("pointerdown",this.onUserEventPanoramaMouse))}),50),e&&e.location&&this.panorama.setPano(e.location.pano),this.panorama.setPov({heading:270,pitch:0}),this.panorama.setZoom(0)},initTimer(e,t){const r=new Date;r.setSeconds(r.getSeconds()+e),t&&(this.timeCountdown=e,this.isVisibleCountdownAlert=!0),this.hasTimerStarted?this.endTime=this.endTime>r?r:this.endTime:(this.endTime=r,this.startTimer())},startTimer(e=this.round){e===this.round&&(this.remainingTime=Math.max(0,Math.round((this.endTime-Date.now())/1e3)),this.remainingTime>0?setTimeout((()=>{this.startTimer(e)}),1e3):(this.timerInProgress=!1,this.hasLocationSelected||([y.wz.COUNTRY,y.wz.CUSTOM_AREA].includes(this.mode)?this.$refs.mapContainer.selectRandomLocation((0,f.j8)(this.areasJson,this.areaParams?this.areaParams.data.pathKey:"iso_a2")):this.$refs.mapContainer.selectRandomLocation(this.streetViewService.getRandomLatLng().position))))},updateScore(e,t){this.hasLocationSelected=!0,this.multiplayer||(this.remainingTime=0),this.score+=e,this.points+=t,this.multiplayer&&(this.room.child("finalScore/player"+this.playerNumber).set(this.score),this.room.child("finalPoints/player"+this.playerNumber).set(this.points),this.dialogTitle=this.$t("StreetView.waitForOtherPlayers"),this.dialogMessage=!0)},showResult(){this.scoreHeader=this.score,this.pointsHeader=this.points,this.remainingTime=0,this.dialogMessage=!1,this.isVisibleCountdownAlert=!1,this.overlay=!0,this.$refs.header.stopTimer();for(let e of Object.entries(this.leaderboard))e[1].scoreHeader=e[1].score},async goToNextRound(e=!1){e&&(this.round=0,this.scoreHeader=0,this.pointsHeader=0,this.score=0,this.points=0),this.isReady=!1,this.randomLatLng=null,this.area=null,this.overlay=!1,this.hasTimerStarted=!1,this.hasLocationSelected=!1,this.isVisibleDialog=!1,this.randomFeatureProperties=null,this.multiplayer&&(this.dialogMessage=!0,this.isReady=!1),this.round+=1,1!=this.playerNumber&&this.multiplayer?this.room.child("trigger/player"+this.playerNumber).set(this.round):(await this.loadStreetView(),this.multiplayer||0==this.timeLimitation||this.initTimer(this.timeLimitation)),this.$refs.mapContainer.startNextRound(),this.isReady=!this.multiplayer},exitGame(){this.dialogTitle=this.$t("StreetView.redirectToHomePage"),this.dialogText=this.$t("StreetView.exitGame"),this.dialogMessage=!0,this.canExit=!0,this.room?(this.room.off(),this.room.remove(),this.$router.push("/history")):this.$router.push("/")},finishGame(){this.canExit=!0,this.multiplayer?(this.dialogTitle=this.$t("StreetView.waitForOtherPlayersToFinish"),this.dialogText="",this.dialogMessage=!0):this.$router.push("/history")},onUserEventPanoramaKey(e){(!this.moveControl&&[38,40,87,83,90].includes(e.keyCode)||!this.zoomControl&&[107,109,187,189].includes(e.keyCode)||!this.panControl&&[37,39,65,68,100,102].includes(e.keyCode))&&e.stopPropagation()},onUserEventPanoramaMouse(e){this.panControl||e.stopPropagation()}}},Oe=Ge,De=(0,S.Z)(Oe,d,m,!1,null,"89aed002",null),Be=De.exports},3043:function(e,t,r){const i=r(5794).Z,o=r(6295),a=r(8580).Z;function s(e){if(!e||!e.type||"Feature"!==e.type||-1===["Polygon","MultiPolygon"].indexOf(e.geometry.type))throw new Error("param polygon must be a Feature<(Polygon|MultiPolygon)>");let t;const r=i(e);do{t=o.randomPosition(r)}while(!a(t,e));return t}e.exports=s},5794:function(e,t,r){var i=r(2196);function o(e){var t=[1/0,1/0,-1/0,-1/0];return i.coordEach(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}o["default"]=o,t.Z=o},8580:function(e,t,r){var i=r(3853);function o(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var o=i.getCoord(e),n=i.getGeom(t),l=n.type,u=t.bbox,d=n.coordinates;if(u&&!1===s(o,u))return!1;"Polygon"===l&&(d=[d]);for(var m=!1,c=0;c<d.length&&!m;c++)if(a(o,d[c][0],r.ignoreBoundary)){var h=!1,p=1;while(p<d[c].length&&!h)a(o,d[c][p],!r.ignoreBoundary)&&(h=!0),p++;h||(m=!0)}return m}function a(e,t,r){var i=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],n=t[o][1],l=t[a][0],u=t[a][1],d=e[1]*(s-l)+n*(l-e[0])+u*(e[0]-s)===0&&(s-e[0])*(l-e[0])<=0&&(n-e[1])*(u-e[1])<=0;if(d)return!r;var m=n>e[1]!==u>e[1]&&e[0]<(l-s)*(e[1]-n)/(u-n)+s;m&&(i=!i)}return i}function s(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}t.Z=o},4126:function(e,t){function r(e,t,r){void 0===r&&(r={});var i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function i(e,t,r){switch(void 0===r&&(r={}),e){case"Point":return o(t).geometry;case"LineString":return l(t).geometry;case"Polygon":return s(t).geometry;case"MultiPoint":return c(t).geometry;case"MultiLineString":return m(t).geometry;case"MultiPolygon":return h(t).geometry;default:throw new Error(e+" is invalid")}}function o(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!M(e[0])||!M(e[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:e};return r(o,t,i)}function a(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return o(e,t)})),r)}function s(e,t,i){void 0===i&&(i={});for(var o=0,a=e;o<a.length;o++){var s=a[o];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var n=0;n<s[s.length-1].length;n++)if(s[s.length-1][n]!==s[0][n])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return r(l,t,i)}function n(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return s(e,t)})),r)}function l(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var o={type:"LineString",coordinates:e};return r(o,t,i)}function u(e,t,r){return void 0===r&&(r={}),d(e.map((function(e){return l(e,t)})),r)}function d(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function m(e,t,i){void 0===i&&(i={});var o={type:"MultiLineString",coordinates:e};return r(o,t,i)}function c(e,t,i){void 0===i&&(i={});var o={type:"MultiPoint",coordinates:e};return r(o,t,i)}function h(e,t,i){void 0===i&&(i={});var o={type:"MultiPolygon",coordinates:e};return r(o,t,i)}function p(e,t,i){void 0===i&&(i={});var o={type:"GeometryCollection",geometries:e};return r(o,t,i)}function g(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function f(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e*i}function y(e,r){void 0===r&&(r="kilometers");var i=t.factors[r];if(!i)throw new Error(r+" units is invalid");return e/i}function v(e,t){return b(y(e,t))}function w(e){var t=e%360;return t<0&&(t+=360),t}function b(e){var t=e%(2*Math.PI);return 180*t/Math.PI}function S(e){var t=e%360;return t*Math.PI/180}function P(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return f(y(e,t),r)}function k(e,r,i){if(void 0===r&&(r="meters"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[r];if(!o)throw new Error("invalid original units");var a=t.areaFactors[i];if(!a)throw new Error("invalid final units");return e/o*a}function M(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function _(e){return!!e&&e.constructor===Object}function x(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!M(e))throw new Error("bbox must only contain numbers")}))}function L(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=r,t.geometry=i,t.point=o,t.points=a,t.polygon=s,t.polygons=n,t.lineString=l,t.lineStrings=u,t.featureCollection=d,t.multiLineString=m,t.multiPoint=c,t.multiPolygon=h,t.geometryCollection=p,t.round=g,t.radiansToLength=f,t.lengthToRadians=y,t.lengthToDegrees=v,t.bearingToAzimuth=w,t.radiansToDegrees=b,t.degreesToRadians=S,t.convertLength=P,t.convertArea=k,t.isNumber=M,t.isObject=_,t.validateBBox=x,t.validateId=L},3853:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r(4126);function o(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function a(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function s(e){if(e.length>1&&i.isNumber(e[0])&&i.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return s(e[0]);throw new Error("coordinates must only contain numbers")}function n(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function l(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function u(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var a=o[i];if(!a||"Feature"!==a.type||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+a.geometry.type)}}function d(e){return"Feature"===e.type?e.geometry:e}function m(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}t.getCoord=o,t.getCoords=a,t.containsNumber=s,t.geojsonType=n,t.featureOf=l,t.collectionOf=u,t.getGeom=d,t.getType=m},2196:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r(4126);function o(e,t,r){if(null!==e)for(var i,a,s,n,l,u,d,m,c=0,h=0,p=e.type,g="FeatureCollection"===p,f="Feature"===p,y=g?e.features.length:1,v=0;v<y;v++){d=g?e.features[v].geometry:f?e.geometry:e,m=!!d&&"GeometryCollection"===d.type,l=m?d.geometries.length:1;for(var w=0;w<l;w++){var b=0,S=0;if(n=m?d.geometries[w]:d,null!==n){u=n.coordinates;var P=n.type;switch(c=!r||"Polygon"!==P&&"MultiPolygon"!==P?0:1,P){case null:break;case"Point":if(!1===t(u,h,v,b,S))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(!1===t(u[i],h,v,b,S))return!1;h++,"MultiPoint"===P&&b++}"LineString"===P&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(a=0;a<u[i].length-c;a++){if(!1===t(u[i][a],h,v,b,S))return!1;h++}"MultiLineString"===P&&b++,"Polygon"===P&&S++}"Polygon"===P&&b++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(S=0,a=0;a<u[i].length;a++){for(s=0;s<u[i][a].length-c;s++){if(!1===t(u[i][a][s],h,v,b,S))return!1;h++}S++}b++}break;case"GeometryCollection":for(i=0;i<n.geometries.length;i++)if(!1===o(n.geometries[i],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function a(e,t,r,i){var a=r;return o(e,(function(e,i,o,s,n){a=0===i&&void 0===r?e:t(a,e,i,o,s,n)}),i),a}function s(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length;r++)if(!1===t(e.features[r].properties,r))break;break;case"Feature":t(e.properties,0);break}}function n(e,t,r){var i=r;return s(e,(function(e,o){i=0===o&&void 0===r?e:t(i,e,o)})),i}function l(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)if(!1===t(e.features[r],r))break}function u(e,t,r){var i=r;return l(e,(function(e,o){i=0===o&&void 0===r?e:t(i,e,o)})),i}function d(e){var t=[];return o(e,(function(e){t.push(e)})),t}function m(e,t){var r,i,o,a,s,n,l,u,d,m,c=0,h="FeatureCollection"===e.type,p="Feature"===e.type,g=h?e.features.length:1;for(r=0;r<g;r++){for(n=h?e.features[r].geometry:p?e.geometry:e,u=h?e.features[r].properties:p?e.properties:{},d=h?e.features[r].bbox:p?e.bbox:void 0,m=h?e.features[r].id:p?e.id:void 0,l=!!n&&"GeometryCollection"===n.type,s=l?n.geometries.length:1,o=0;o<s;o++)if(a=l?n.geometries[o]:n,null!==a)switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(a,c,u,d,m))return!1;break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===t(a.geometries[i],c,u,d,m))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,c,u,d,m))return!1;c++}}function c(e,t,r){var i=r;return m(e,(function(e,o,a,s,n){i=0===o&&void 0===r?e:t(i,e,o,a,s,n)})),i}function h(e,t){m(e,(function(e,r,o,a,s){var n,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(i.feature(e,o,{bbox:a,id:s}),r,0)&&void 0}switch(l){case"MultiPoint":n="Point";break;case"MultiLineString":n="LineString";break;case"MultiPolygon":n="Polygon";break}for(var u=0;u<e.coordinates.length;u++){var d=e.coordinates[u],m={type:n,coordinates:d};if(!1===t(i.feature(m,o),r,u))return!1}}))}function p(e,t,r){var i=r;return h(e,(function(e,o,a){i=0===o&&0===a&&void 0===r?e:t(i,e,o,a)})),i}function g(e,t){h(e,(function(e,r,a){var s=0;if(e.geometry){var n=e.geometry.type;if("Point"!==n&&"MultiPoint"!==n){var l,u=0,d=0,m=0;return!1!==o(e,(function(o,n,c,h,p){if(void 0===l||r>u||h>d||p>m)return l=o,u=r,d=h,m=p,void(s=0);var g=i.lineString([l,o],e.properties);if(!1===t(g,r,a,p,s))return!1;s++,l=o}))&&void 0}}}))}function f(e,t,r){var i=r,o=!1;return g(e,(function(e,a,s,n,l){i=!1===o&&void 0===r?e:t(i,e,a,s,n,l),o=!0})),i}function y(e,t){if(!e)throw new Error("geojson is required");h(e,(function(e,r,o){if(null!==e.geometry){var a=e.geometry.type,s=e.geometry.coordinates;switch(a){case"LineString":if(!1===t(e,r,o,0,0))return!1;break;case"Polygon":for(var n=0;n<s.length;n++)if(!1===t(i.lineString(s[n],e.properties),r,o,n))return!1;break}}}))}function v(e,t,r){var i=r;return y(e,(function(e,o,a,s){i=0===o&&void 0===r?e:t(i,e,o,a,s)})),i}function w(e,t){if(t=t||{},!i.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,a=t.multiFeatureIndex||0,s=t.geometryIndex||0,n=t.segmentIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),l=l||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":l=l||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return n<0&&(n=u.length+n-1),i.lineString([u[n],u[n+1]],l,t);case"Polygon":return s<0&&(s=u.length+s),n<0&&(n=u[s].length+n-1),i.lineString([u[s][n],u[s][n+1]],l,t);case"MultiLineString":return a<0&&(a=u.length+a),n<0&&(n=u[a].length+n-1),i.lineString([u[a][n],u[a][n+1]],l,t);case"MultiPolygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s),n<0&&(n=u[a][s].length-n-1),i.lineString([u[a][s][n],u[a][s][n+1]],l,t)}throw new Error("geojson is invalid")}function b(e,t){if(t=t||{},!i.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,a=t.multiFeatureIndex||0,s=t.geometryIndex||0,n=t.coordIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),l=l||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":l=l||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return i.point(u,l,t);case"MultiPoint":return a<0&&(a=u.length+a),i.point(u[a],l,t);case"LineString":return n<0&&(n=u.length+n),i.point(u[n],l,t);case"Polygon":return s<0&&(s=u.length+s),n<0&&(n=u[s].length+n),i.point(u[s][n],l,t);case"MultiLineString":return a<0&&(a=u.length+a),n<0&&(n=u[a].length+n),i.point(u[a][n],l,t);case"MultiPolygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s),n<0&&(n=u[a][s].length-n),i.point(u[a][s][n],l,t)}throw new Error("geojson is invalid")}t.coordAll=d,t.coordEach=o,t.coordReduce=a,t.featureEach=l,t.featureReduce=u,t.findPoint=b,t.findSegment=w,t.flattenEach=h,t.flattenReduce=p,t.geomEach=m,t.geomReduce=c,t.lineEach=y,t.lineReduce=v,t.propEach=s,t.propReduce=n,t.segmentEach=g,t.segmentReduce=f}}]);
//# sourceMappingURL=731.34256842.js.map